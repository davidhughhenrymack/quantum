

include "cpu";


const width = 3;
const cells = 2^width;

// Does it work inside another funct?
cond qufunct fetchy(quconst addr, qureg mem, qureg dest) {
	qureg o[1];
	int cell;
	const cells = #mem/width-1;

	for cell = 0 to cells
	{
		eq(addr,cell,o);
		if o { Swap(seek(mem,cell,width),dest); }
		!eq(addr,cell,o);
	}
	
}

print "Testing eq()";

qureg a[width];
qureg dest[width];
qureg mem[cells * width];
int rOut;
int i;
int j;
int tst;
boolean fail;


for i = 0 to cells-1
{
	tst = floor(random()* 2^width);

	set(i, a);
	set(tst, seek(mem,i,width));

	fetchy(a, mem, dest);

	measure dest, rOut;
	if rOut == tst {
		print "Pass", rOut, "=", tst, "cycle", i;
	} else {
		print "Fail", rOut, "=", tst, "cycle", i;
		fail = true;
	}

	reset;
}

if fail {
	print "Failed";
} else {
	print "Passed";
}



include "cpu";


print "Testing fetch()";

qureg a[width];
qureg dest[width];
qureg mem[cells * width];
qureg o[cells];
int rOut;
int i;
int j;
int tst;
int fail;

int memIn;
int memOut;

// 16434824 is ascending numbers 0 to 7 in three bit cells


for i = 0 to cells-1
{
	// if i != 0 {
	// 	quickrand(mem);
	// }
	set(16434824, mem);
	set(i, a);
	
	measure seek(mem,i), tst;
	measure mem, memIn;

	// set log 1;
	fetch2(a, mem, dest);
	// set log 0;

	measure dest, rOut;
	// !fetchpll(a, mem, dest);
	// dump mem;

	measure mem, memOut;

	if rOut == tst and memOut == memIn {
		print i, "Pass:", rOut, "=", tst, memOut, "=", memIn;
	} else {
		print i, "Fail:", rOut, "=", tst, memOut, "=", memIn;
		fail = fail + 1;
	}

	reset;
}

if fail > 0 {
	print "Failed" , fail, "times";
} else {
	print "Passed";
}
